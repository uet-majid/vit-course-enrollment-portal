{% extends "base/base.html" %}

{% block title %}Course Enrollments{% endblock %}
{% block page_title %}Course Enrollments{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item active">Course Enrollments</li>
{% endblock %}
{% block content %}
<div class="card stretch stretch-full">
  <div class="card-body p-0">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center p-4 border-bottom">
      <h5 class="fw-bold mb-0">Student Enrollments</h5>

      <form method="get" class="d-flex gap-2 col-md-2">
        <select name="semester" class="form-select form-select-sm" onchange="this.form.submit()">
          <option value="">Current Semester</option>
          {% for s in semesters %}
          <option value="{{ s.id }}" {% if selected_semester == s.id|stringformat:"s" %}selected{% endif %}>
            {{ s.name }}
          </option>
          {% endfor %}
        </select>
      </form>
    </div>

    {% if messages %}
    <div class="px-4 pt-3">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
        {{ message }}
        <button class="btn-close" data-bs-dismiss="alert"></button>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Table -->
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0" id="enrollmentTable">
        <thead class="table-light">
          <tr>
            <th>Sr. No.</th>
            <th>Student ID</th>
            <th>Name</th>
            <th>Department</th>
            <th>Enrolled Courses</th>
            <th>Credits</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for s in students %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ s.student_id }}</td>
            <td>{{ s.user.get_full_name }}</td>
            <td>{{ s.department.name }}</td>
            <td>
              <span class="badge bg-primary">
                {{ s.enrolled_count }}
              </span>
            </td>
            <td>
              <span class="badge bg-info">
                {{ s.enrolled_credits }} / {{ s.degree_program.max_credits_per_semester }}
              </span>
            </td>
            <td>
              <div class="hstack gap-2">
                <a
                  href="{% url 'student_enrollment_detail' s.id %}"
                  class="avatar-text avatar-md"
                  title="View Enrollment Details"
                >
                  <i class="feather-eye"></i>
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>

{% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    if (!$.fn.DataTable.isDataTable("#enrollmentTable")) {
      $("#enrollmentTable").DataTable({
        pageLength: 10,
        responsive: true,
        columnDefs: [{ orderable: false, targets: [-1] }],
        language: {
          emptyTable: "No student enrollments found"
        }
      });
    }
  });
</script>
{% endblock %}

{% endblock %}
